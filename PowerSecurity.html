<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>טופס גיוס - כח אבטחה</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Heebo', sans-serif;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
        }

        #form-container {
            width: 100%;
            max-width: 600px;
            padding: 2rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .form-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: bold;
        }

        .form-control, .form-select {
            margin-bottom: 1rem;
            border-radius: 10px;
            text-align: center; /* Add this line to center the text */
        }

        .form-select {
            text-align-last: center; /* Add this line to center the text in dropdowns */
        }
        

        .checkbox-container {
            margin-bottom: 1rem;
        }

        .checkbox-container label {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .checkbox-container input[type="checkbox"] {
            margin-left: 0.5rem;
        }

        #submit-btn {
            width: 100%;
            padding: 0.75rem;
            font-size: 1.1rem;
            border-radius: 10px;
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            border: none;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }

        #submit-btn:hover {
            background: linear-gradient(135deg, #128C7E 0%, #25D366 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #disclaimer {
            color: #d1d1d1;
            text-align: center;
            margin-top: 1rem;
            font-size: 0.8rem;
        }

        .custom-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            width: 300px;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div id="form-container">
        <h1 class="form-title">מלאו הטופס הבא ותועברו לשיחת וואטסאפ עם "כח אבטחה"</h1>
        <form id="recruitment-form">
            <div class="row">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="fullName" placeholder="שם מלא" required>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" id="city" placeholder="יישוב מגורים" required>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="lastJob" placeholder="מקום ותפקיד עבודה אחרון" required>
                </div>
                <div class="col-md-6">
                    <input type="tel" class="form-control" id="phone" placeholder="טלפון" pattern="[0-9]*" inputmode="numeric" required>
                </div>
            </div>
            <select class="form-select" id="trainingLevel" required>
                <option value="" disabled selected>רמת הכשרה</option>
                <option value="בודק בטחוני">בודק בטחוני</option>
                <option value="סדרן ספורט">סדרן ספורט</option>
                <option value="רמה א'">רמה א'</option>
                <option value="מתקדם ב'">מתקדם ב'</option>
                <option value="אחר">אחר</option>
            </select>
            <input type="text" class="form-control" id="otherTraining" placeholder="פרט רמת הכשרה אחרת" style="display: none;">
            <select class="form-select" id="desiredRole" required>
                <option value="" disabled selected>תפקיד רצוי</option>
                <option value="תפקיד מטה">תפקיד מטה</option>
                <option value="תפקיד אבטחה">תפקיד אבטחה</option>
            </select>
            <div class="checkbox-container">
                <h5>סמנו מה שרלוונטי עבורכם:</h5>
                <label><input type="checkbox" id="fullMilitaryService"> שירות צבאי מלא</label>
                <label><input type="checkbox" id="rifleman"> רובאי 02 ומעלה</label>
                <label><input type="checkbox" id="combatCertificate"> בעל תעודת לוחם</label>
                <label><input type="checkbox" id="cleanRecord"> עבר ללא דופי</label>
                <label><input type="checkbox" id="mobile"> נייד (אופנוע/רכב)</label>
                <label><input type="checkbox" id="healthyStatus"> בריאות תקינה</label>
            </div>
            <button type="button" id="submit-btn" onclick="submitForm()">
                המשך לשיחת וואטסאפ עם "כח אבטחה" <i class="fab fa-whatsapp"></i>
            </button>
        </form>
        <div id="disclaimer">
            <small>הפרטים יישלחו בהתאם למדיניות הפרטיות.</small>
        </div>
    </div>
    <div id="alert-container"></div>

    <script>
        const webAppUrl = 'https://script.google.com/macros/s/AKfycbxQqXi1UAZViOoUXQWfSU11aPCLYcTZ91VEFKExx-ey0ninroPEVZEjwTY5lhYn0rGzKQ/exec';

        function showAlert(type, message) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.classList.add('custom-alert', `alert-${type}`);
            alert.textContent = message;
            alertContainer.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        document.getElementById('trainingLevel').addEventListener('change', function() {
            const otherTraining = document.getElementById('otherTraining');
            otherTraining.style.display = this.value === 'אחר' ? 'block' : 'none';
            otherTraining.required = this.value === 'אחר';
        });

        function formatTimestamp(date) {
            const pad = (n) => n.toString().padStart(2, '0');
            return `${pad(date.getDate())}/${pad(date.getMonth() + 1)}/${date.getFullYear()} ${pad(date.getHours())}:${pad(date.getMinutes())}`;
        }

        function submitForm() {
            const fullName = document.getElementById('fullName').value;
            const city = document.getElementById('city').value;
            const lastJob = document.getElementById('lastJob').value;
            const phone = document.getElementById('phone').value;
            const trainingLevel = document.getElementById('trainingLevel').value;
            const otherTraining = document.getElementById('otherTraining').value;
            const desiredRole = document.getElementById('desiredRole').value;

            if (!fullName || !city || !lastJob || !phone || !trainingLevel || !desiredRole || (trainingLevel === 'אחר' && !otherTraining)) {
                showAlert('danger', 'אנא מלאו את כל השדות הנדרשים');
                return;
            }

            if (!phone.match(/^[0-9]*$/)) {
                showAlert('danger', 'אנא הכניסו מספר טלפון תקין');
                return;
            }

            const checkboxes = ['fullMilitaryService', 'rifleman', 'combatCertificate', 'cleanRecord', 'mobile', 'healthyStatus'];
            const relevantItems = checkboxes.filter(id => document.getElementById(id).checked);

            const timestamp = formatTimestamp(new Date());

            const formData = {
                timestamp: timestamp,
                fullName: fullName,
                city: city,
                lastJob: lastJob,
                phone: phone,
                trainingLevel: trainingLevel === 'אחר' ? otherTraining : trainingLevel,
                desiredRole: desiredRole,
                fullMilitaryService: document.getElementById('fullMilitaryService').checked,
                rifleman: document.getElementById('rifleman').checked,
                combatCertificate: document.getElementById('combatCertificate').checked,
                cleanRecord: document.getElementById('cleanRecord').checked,
                mobile: document.getElementById('mobile').checked,
                healthyStatus: document.getElementById('healthyStatus').checked
            };

            const whatsappMessage = `
שלום, אני פונה אליכם בעקבות טופס הגיוס ל"כח אבטחה".

*זמן מילוי הטופס:* ${timestamp}
*שם מלא:* ${fullName}
*יישוב מגורים:* ${city}
*מקום ותפקיד עבודה אחרון:* ${lastJob}
*טלפון:* ${phone}
*רמת הכשרה:* ${trainingLevel === 'אחר' ? otherTraining : trainingLevel}
*תפקיד רצוי:* ${desiredRole}

*פרטים נוספים:*
${checkboxes.map(item => `${document.getElementById(item).checked ? '✅' : '❌'} ${document.querySelector(`label[for="${item}"]`).textContent.trim()}`).join('\n')}

אשמח לקבל מידע נוסף ולהמשיך בתהליך.
            `.trim();

            const encodedMessage = encodeURIComponent(whatsappMessage);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=972523141216&text=${encodedMessage}`;

            // Send data to Google Sheets
            fetch(webAppUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(() => {
                console.log('Form data sent successfully');
                window.location.href = whatsappUrl;
            })
            .catch((error) => {
                console.error('Error:', error);
                showAlert('danger', 'אירעה שגיאה בשליחת הטופס. אנא נסו שוב מאוחר יותר.');
            });
        }
    </script>

</body>
</html>
